<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libgpucrypto: aes_context Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libgpucrypto
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">aes_context Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d8/d8f/aes__context_8hh_source.html">aes_context.hh</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7832d710761084a6451d93156cf6b79d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d01/classaes__context.html#a7832d710761084a6451d93156cf6b79d">aes_context</a> (<a class="el" href="../../de/d3e/classdevice__context.html">device_context</a> *dev_ctx)</td></tr>
<tr class="separator:a7832d710761084a6451d93156cf6b79d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c4b9ec90489cb61505c0d0fc2c71141"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d01/classaes__context.html#a9c4b9ec90489cb61505c0d0fc2c71141">ecb_128_encrypt</a> (const void *memory_start, const unsigned long in_pos, const unsigned long keys_pos, const unsigned long pkt_index_pos, const unsigned long data_size, unsigned char *out, const unsigned long block_count, const unsigned long num_flows, unsigned int stream_id)</td></tr>
<tr class="separator:a9c4b9ec90489cb61505c0d0fc2c71141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e565046430a3bc259b301ab9f0d3124"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d01/classaes__context.html#a4e565046430a3bc259b301ab9f0d3124">ecb_128_encrypt_nocopy</a> (const void *memory_start, const unsigned long in_pos, const unsigned long keys_pos, const unsigned long pkt_index_pos, const unsigned long data_size, unsigned char *out, const unsigned long block_count, const unsigned long num_flows, unsigned int stream_id)</td></tr>
<tr class="separator:a4e565046430a3bc259b301ab9f0d3124"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a350c3c86ba1d0769b6b7e4a5e6983afc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d01/classaes__context.html#a350c3c86ba1d0769b6b7e4a5e6983afc">cbc_encrypt</a> (const void *memory_start, const unsigned long in_pos, const unsigned long keys_pos, const unsigned long ivs_pos, const unsigned long pkt_offset_pos, const unsigned long tot_in_len, unsigned char *out, const unsigned long num_flows, const unsigned long tot_out_len, const unsigned int stream_id, const unsigned int bits=128)</td></tr>
<tr class="separator:a350c3c86ba1d0769b6b7e4a5e6983afc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32e08d6083d19476f285b6317da8771b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d01/classaes__context.html#a32e08d6083d19476f285b6317da8771b">cbc_decrypt</a> (const void *memory_start, const unsigned long in_pos, const unsigned long keys_pos, const unsigned long ivs_pos, const unsigned long pkt_index_pos, const unsigned long data_size, unsigned char *out, const unsigned long block_count, const unsigned long num_flows, unsigned int stream_id, const unsigned int bits=128)</td></tr>
<tr class="separator:a32e08d6083d19476f285b6317da8771b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3638659adca332c65dccb8291a056dd3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3">sync</a> (const unsigned int stream_id, const bool block=true, const bool copy_result=true)</td></tr>
<tr class="separator:a3638659adca332c65dccb8291a056dd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>class <a class="el" href="../../d7/d01/classaes__context.html">aes_context</a></p>
<p>Interface for AES cipher in GPU. It supports 128-bit CBC-mode encryption/decryptiion, ecb 128 bit encryption. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a7832d710761084a6451d93156cf6b79d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7832d710761084a6451d93156cf6b79d">&#9670;&nbsp;</a></span>aes_context()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">aes_context::aes_context </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d3e/classdevice__context.html">device_context</a> *&#160;</td>
          <td class="paramname"><em>dev_ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructior.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dev_ctx</td><td>Device context pointer. Device context must be initialized before calling this function. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;{</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        dev_ctx_ = dev_ctx;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt;= MAX_STREAM; i++) {</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                streams[i].out = 0;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                streams[i].out_d = 0;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                streams[i].out_len = 0;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        }</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a32e08d6083d19476f285b6317da8771b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32e08d6083d19476f285b6317da8771b">&#9670;&nbsp;</a></span>cbc_decrypt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void aes_context::cbc_decrypt </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>memory_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>in_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>keys_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>ivs_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>pkt_index_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>data_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>block_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>num_flows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>stream_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>bits</em> = <code>128</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>It executes AES-CBC encryption in GPU.</p>
<p>It only supports 128-bit key length at the moment.</p>
<p>If stream is enabled it will run in non-blocking mode, if not, it will run in blocking mode and the result will be written back to out at the end of function call. This function takes one or more plaintext and returns ciphertext for all of them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">memory_start</td><td>Starting point of input data. </td></tr>
    <tr><td class="paramname">in_pos</td><td>Offset of plain texts. All plain texts are gathered in to one big buffer with 16-byte align which is AES block size. </td></tr>
    <tr><td class="paramname">keys_pos</td><td>Offset of region that stores keys. </td></tr>
    <tr><td class="paramname">ivs_pos</td><td>Offset of region that store IVs. </td></tr>
    <tr><td class="paramname">pkt_index_pos</td><td>Offset of region that stores per plain text index for every block. It is used to locate key an IV. </td></tr>
    <tr><td class="paramname">data_size</td><td>Total amount of input data. </td></tr>
    <tr><td class="paramname">out</td><td>Buffer to store output. </td></tr>
    <tr><td class="paramname">block_count</td><td>Total number of blocks in all plain texts. </td></tr>
    <tr><td class="paramname">num_flows</td><td>Total number of plain text. </td></tr>
    <tr><td class="paramname">stream_id</td><td>Stream index. </td></tr>
    <tr><td class="paramname">bits</td><td>key length for AES cipher </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;{</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        assert(bits==128);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        assert(dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == READY);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_KERNEL);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> total_len = block_count * AES_BLOCK_SIZE;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        uint8_t *in_d;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        uint8_t *keys_d;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        uint8_t *ivs_d;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        uint16_t *pkt_index_d;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordtype">void</span> *memory_d;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> threads_per_blk = 512;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordtype">int</span> num_blks = (block_count + threads_per_blk - 1) / threads_per_blk;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="comment">//transfor encrypt key to decrypt key</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="comment">//basically it generates round key and take the last</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">//CUDA code will generate the round key in reverse order</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; num_flows; i++) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                uint8_t *key = (uint8_t *)memory_start + keys_pos + i * bits / 8;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                AES_decrypt_key_prepare(key, key, bits);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#af66b74eb3019d5936c9759463c55e7f8">clear_checkbits</a>(stream_id, num_blks);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="../../d4/d45/classcuda__mem__pool.html">cuda_mem_pool</a> *pool = dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3">get_cuda_mem_pool</a>(stream_id);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        memory_d = pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(data_size);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        cudaMemcpyAsync(memory_d,</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        memory_start,</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                        data_size,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                        cudaMemcpyHostToDevice,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        streams[stream_id].out_d = (uint8_t*)pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(total_len);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        in_d        = (uint8_t *) memory_d + in_pos;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        keys_d      = (uint8_t *) memory_d + keys_pos;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        ivs_d       = (uint8_t *) memory_d + ivs_pos;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        pkt_index_d = (uint16_t *) ((uint8_t *) memory_d + pkt_index_pos);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        assert(bits == 128);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>() &amp;&amp; stream_id &gt; 0) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                AES_cbc_128_decrypt_gpu(in_d,</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                                        streams[stream_id].out_d,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                        keys_d,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                        ivs_d,</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                        pkt_index_d,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                                        block_count,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa">get_dev_checkbits</a>(stream_id),</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                        threads_per_blk,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stream_id == 0) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                AES_cbc_128_decrypt_gpu(in_d,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                        streams[stream_id].out_d,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                        keys_d,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                        ivs_d,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                        pkt_index_d,</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                        block_count,</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa">get_dev_checkbits</a>(stream_id),</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                        threads_per_blk);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                assert(0);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        assert(cudaGetLastError() == cudaSuccess);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        streams[stream_id].out     = out;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        streams[stream_id].out_len = total_len;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">if</span> (!dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>()) {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <a class="code" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3">sync</a>(stream_id, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d01/classaes__context_a32e08d6083d19476f285b6317da8771b_cgraph.png" border="0" usemap="#d7/d01/classaes__context_a32e08d6083d19476f285b6317da8771b_cgraph" alt=""/></div>
<map name="d7/d01/classaes__context_a32e08d6083d19476f285b6317da8771b_cgraph" id="d7/d01/classaes__context_a32e08d6083d19476f285b6317da8771b_cgraph">
<area shape="rect" title=" " alt="" coords="5,253,173,280"/>
<area shape="rect" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b" title=" " alt="" coords="235,5,350,32"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#af66b74eb3019d5936c9759463c55e7f8" title=" " alt="" coords="221,57,364,98"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3" title=" " alt="" coords="226,122,359,163"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa" title=" " alt="" coords="226,187,359,229"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100" title=" " alt="" coords="417,231,550,273"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362" title=" " alt="" coords="417,297,550,338"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b" title=" " alt="" coords="417,414,550,455"/>
<area shape="rect" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3" title=" " alt="" coords="230,355,355,381"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09" title=" " alt="" coords="225,457,361,498"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0" title=" " alt="" coords="412,363,555,389"/>
</map>
</div>

</div>
</div>
<a id="a350c3c86ba1d0769b6b7e4a5e6983afc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a350c3c86ba1d0769b6b7e4a5e6983afc">&#9670;&nbsp;</a></span>cbc_encrypt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void aes_context::cbc_encrypt </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>memory_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>in_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>keys_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>ivs_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>pkt_offset_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>tot_in_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>num_flows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>tot_out_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>stream_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>bits</em> = <code>128</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>It executes AES-CBC encryption in GPU.</p>
<p>It only supports 128-bit key length at the moment.</p>
<p>If stream is enabled it will run in non-blocking mode, if not, it will run in blocking mode and the result will be written back to out at the end of function call. This function takes one or more plaintext and returns ciphertext for all of them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">memory_start</td><td>Starting point of input data. </td></tr>
    <tr><td class="paramname">in_pos</td><td>Offset of plain texts. All plain texts are gathered in to one big buffer with 16-byte align which is AES block size. </td></tr>
    <tr><td class="paramname">keys_pos</td><td>Offset of region that stores keys. </td></tr>
    <tr><td class="paramname">ivs_pos</td><td>Offset of region that store IVs. </td></tr>
    <tr><td class="paramname">pkt_offset_pos</td><td>Offset of region that stores position of the beginning of each plain text. </td></tr>
    <tr><td class="paramname">tot_in_len</td><td>Total amount of input data plus meta data. </td></tr>
    <tr><td class="paramname">out</td><td>Buffer to store output. </td></tr>
    <tr><td class="paramname">block_count</td><td>Total number of blocks in all plain texts. </td></tr>
    <tr><td class="paramname">num_flows</td><td>Total number of plain text. </td></tr>
    <tr><td class="paramname">tot_out_len</td><td>Total amount of output length. </td></tr>
    <tr><td class="paramname">stream_id</td><td>Stream index. </td></tr>
    <tr><td class="paramname">bits</td><td>key length for AES cipher </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        assert(bits == 128);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        assert(dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == READY);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_KERNEL);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <span class="comment">/* Allocate memory on device */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        uint8_t *in_d;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        uint8_t *keys_d;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        uint8_t *ivs_d;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        uint32_t *pkt_offset_d;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordtype">void</span> *memory_d;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="comment">//Calculate # of cuda blks required</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  threads_per_blk = THREADS_PER_BLK;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordtype">int</span>           num_blks        = (num_flows + threads_per_blk - 1) / threads_per_blk;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="../../d4/d45/classcuda__mem__pool.html">cuda_mem_pool</a> *pool           = dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3">get_cuda_mem_pool</a>(stream_id);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        memory_d = pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(tot_in_len);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        cudaMemcpyAsync(memory_d, memory_start, tot_in_len,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                        cudaMemcpyHostToDevice, dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#af66b74eb3019d5936c9759463c55e7f8">clear_checkbits</a>(stream_id, num_blks);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        streams[stream_id].out_d = (uint8_t*)pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(tot_out_len);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        in_d         = (uint8_t *) memory_d + in_pos;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        keys_d       = (uint8_t *) memory_d + keys_pos;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        ivs_d        = (uint8_t *) memory_d + ivs_pos;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        pkt_offset_d = (uint32_t *) ((uint8_t *)memory_d + pkt_offset_pos);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="comment">/* Call cbc kernel function to do encryption */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>()) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                AES_cbc_128_encrypt_gpu(in_d,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                                        streams[stream_id].out_d,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                                        pkt_offset_d,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                                        keys_d,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                                        ivs_d,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                                        num_flows,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa">get_dev_checkbits</a>(stream_id),</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                                        threads_per_blk,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                AES_cbc_128_encrypt_gpu(in_d,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                        streams[stream_id].out_d,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                                        pkt_offset_d,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                        keys_d,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                                        ivs_d,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                        num_flows,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa">get_dev_checkbits</a>(stream_id),</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                        threads_per_blk);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        assert(cudaGetLastError() == cudaSuccess);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        streams[stream_id].out     = out;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        streams[stream_id].out_len = tot_out_len;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="comment">/* Copy data back from device to host */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> (!dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>()) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <a class="code" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3">sync</a>(stream_id);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d01/classaes__context_a350c3c86ba1d0769b6b7e4a5e6983afc_cgraph.png" border="0" usemap="#d7/d01/classaes__context_a350c3c86ba1d0769b6b7e4a5e6983afc_cgraph" alt=""/></div>
<map name="d7/d01/classaes__context_a350c3c86ba1d0769b6b7e4a5e6983afc_cgraph" id="d7/d01/classaes__context_a350c3c86ba1d0769b6b7e4a5e6983afc_cgraph">
<area shape="rect" title=" " alt="" coords="5,253,173,280"/>
<area shape="rect" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b" title=" " alt="" coords="235,5,350,32"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#af66b74eb3019d5936c9759463c55e7f8" title=" " alt="" coords="221,57,364,98"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3" title=" " alt="" coords="226,122,359,163"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa" title=" " alt="" coords="226,187,359,229"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100" title=" " alt="" coords="417,231,550,273"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362" title=" " alt="" coords="417,297,550,338"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b" title=" " alt="" coords="417,414,550,455"/>
<area shape="rect" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3" title=" " alt="" coords="230,355,355,381"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09" title=" " alt="" coords="225,457,361,498"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0" title=" " alt="" coords="412,363,555,389"/>
</map>
</div>

</div>
</div>
<a id="a9c4b9ec90489cb61505c0d0fc2c71141"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c4b9ec90489cb61505c0d0fc2c71141">&#9670;&nbsp;</a></span>ecb_128_encrypt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void aes_context::ecb_128_encrypt </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>memory_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>in_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>keys_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>pkt_index_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>data_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>block_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>num_flows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>stream_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>It executes AES-ECB-128 encryption in GPU. If stream is enabled it will run in non-blocking mode, if not, it will run in blocking mode and the result will be written back to out at the end of function call. This function takes one or more plaintext and returns ciphertext for all of them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">memory_start</td><td>Starting point of input data. </td></tr>
    <tr><td class="paramname">in_pos</td><td>Offset of plain texts. All plain texts are gathered in to one big buffer with 16-byte align which is AES block size. </td></tr>
    <tr><td class="paramname">keys_pos</td><td>Offset of region that stores keys. </td></tr>
    <tr><td class="paramname">pkt_index_pos</td><td>Offset of region that stores per plain text index for every block. </td></tr>
    <tr><td class="paramname">data_size</td><td>Total amount of input data. </td></tr>
    <tr><td class="paramname">out</td><td>Buffer to store output. </td></tr>
    <tr><td class="paramname">block_count</td><td>Total number of blocks in all plain texts. </td></tr>
    <tr><td class="paramname">num_flows</td><td>Total number of plain text. </td></tr>
    <tr><td class="paramname">stream_id</td><td>Stream index. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;{</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        assert(dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == READY);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> total_len = block_count * AES_BLOCK_SIZE;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        uint8_t *in_d;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        uint8_t *keys_d;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        uint16_t *pkt_index_d;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordtype">void</span> * memory_d;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="../../d4/d45/classcuda__mem__pool.html">cuda_mem_pool</a> *pool = dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3">get_cuda_mem_pool</a>(stream_id);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        memory_d = pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(data_size);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        cudaMemcpyAsync(memory_d, memory_start, data_size,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                        cudaMemcpyHostToDevice, dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        streams[stream_id].out_d = (uint8_t *) pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(total_len);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        in_d        = (uint8_t *) memory_d + in_pos;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        keys_d      = (uint8_t *) memory_d + keys_pos;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        pkt_index_d = (uint16_t *) ((uint8_t *) memory_d + pkt_index_pos);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> threads_per_blk = THREADS_PER_BLK;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>())</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                AES_ecb_128_encrypt_gpu(in_d,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                        streams[stream_id].out_d,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                        keys_d,</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                        pkt_index_d,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                        block_count,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                        threads_per_blk,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                AES_ecb_128_encrypt_gpu(in_d,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                        streams[stream_id].out_d,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                        keys_d,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                        pkt_index_d,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                        block_count,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                        threads_per_blk);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_KERNEL);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        streams[stream_id].out     = out;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        streams[stream_id].out_len = total_len;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span> (!dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>()) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                <a class="code" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3">sync</a>(stream_id);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d01/classaes__context_a9c4b9ec90489cb61505c0d0fc2c71141_cgraph.png" border="0" usemap="#d7/d01/classaes__context_a9c4b9ec90489cb61505c0d0fc2c71141_cgraph" alt=""/></div>
<map name="d7/d01/classaes__context_a9c4b9ec90489cb61505c0d0fc2c71141_cgraph" id="d7/d01/classaes__context_a9c4b9ec90489cb61505c0d0fc2c71141_cgraph">
<area shape="rect" title=" " alt="" coords="5,166,152,207"/>
<area shape="rect" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b" title=" " alt="" coords="211,5,325,32"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3" title=" " alt="" coords="201,57,335,98"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100" title=" " alt="" coords="389,101,522,142"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362" title=" " alt="" coords="389,166,522,207"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b" title=" " alt="" coords="389,283,522,325"/>
<area shape="rect" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3" title=" " alt="" coords="205,224,331,251"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09" title=" " alt="" coords="200,326,336,367"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0" title=" " alt="" coords="384,232,527,259"/>
</map>
</div>

</div>
</div>
<a id="a4e565046430a3bc259b301ab9f0d3124"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e565046430a3bc259b301ab9f0d3124">&#9670;&nbsp;</a></span>ecb_128_encrypt_nocopy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void aes_context::ecb_128_encrypt_nocopy </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>memory_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>in_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>keys_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>pkt_index_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>data_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>block_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>num_flows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>stream_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>It executes AES-ECB-128 encryption in GPU. This function differs from ecb_128_encrypt in that it will not involve any data copy from/to GPU. This was intended to measure purely AES computation performance using GPU.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">memory_start</td><td>Starting point of input data. </td></tr>
    <tr><td class="paramname">in_pos</td><td>Offset of plain texts. All plain texts are gathered in to one big buffer with 16-byte align which is AES block size. </td></tr>
    <tr><td class="paramname">keys_pos</td><td>Offset of region that stores keys. </td></tr>
    <tr><td class="paramname">pkt_index_pos</td><td>Offset of region that stores per plain text index for every block. </td></tr>
    <tr><td class="paramname">data_size</td><td>Total amount of input data. </td></tr>
    <tr><td class="paramname">out</td><td>Buffer to store output. </td></tr>
    <tr><td class="paramname">block_count</td><td>Total number of blocks in all plain texts. </td></tr>
    <tr><td class="paramname">num_flows</td><td>Total number of plain text. </td></tr>
    <tr><td class="paramname">stream_id</td><td>Stream index. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;{</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        assert(dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == READY);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> total_len = block_count * AES_BLOCK_SIZE;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        uint8_t *in_d;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        uint8_t *keys_d;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        uint16_t *pkt_index_d;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordtype">void</span> * memory_d;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <a class="code" href="../../d4/d45/classcuda__mem__pool.html">cuda_mem_pool</a> *pool = dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3">get_cuda_mem_pool</a>(stream_id);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        memory_d                 = pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(data_size);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        streams[stream_id].out_d = (uint8_t*)pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(total_len);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        in_d                     = (uint8_t *) memory_d + in_pos;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        keys_d                   = (uint8_t *) memory_d + keys_pos;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        pkt_index_d              = (uint16_t *) ((uint8_t *) memory_d + pkt_index_pos);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> threads_per_blk = THREADS_PER_BLK;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>())</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                AES_ecb_128_encrypt_gpu(in_d,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                        streams[stream_id].out_d,</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                        keys_d,</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                        pkt_index_d,</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                        block_count,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                        threads_per_blk,</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                AES_ecb_128_encrypt_gpu(in_d,</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                        streams[stream_id].out_d,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                        keys_d, pkt_index_d,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                        block_count,</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                        threads_per_blk);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        assert(cudaGetLastError() == cudaSuccess);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_KERNEL);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        streams[stream_id].out     = out;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        streams[stream_id].out_len = total_len;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> (!dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>()) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <a class="code" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3">sync</a>(stream_id);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d01/classaes__context_a4e565046430a3bc259b301ab9f0d3124_cgraph.png" border="0" usemap="#d7/d01/classaes__context_a4e565046430a3bc259b301ab9f0d3124_cgraph" alt=""/></div>
<map name="d7/d01/classaes__context_a4e565046430a3bc259b301ab9f0d3124_cgraph" id="d7/d01/classaes__context_a4e565046430a3bc259b301ab9f0d3124_cgraph">
<area shape="rect" title=" " alt="" coords="5,166,152,207"/>
<area shape="rect" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b" title=" " alt="" coords="211,5,325,32"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3" title=" " alt="" coords="201,57,335,98"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100" title=" " alt="" coords="389,101,522,142"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362" title=" " alt="" coords="389,166,522,207"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b" title=" " alt="" coords="389,283,522,325"/>
<area shape="rect" href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3" title=" " alt="" coords="205,224,331,251"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09" title=" " alt="" coords="200,326,336,367"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0" title=" " alt="" coords="384,232,527,259"/>
</map>
</div>

</div>
</div>
<a id="a3638659adca332c65dccb8291a056dd3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3638659adca332c65dccb8291a056dd3">&#9670;&nbsp;</a></span>sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool aes_context::sync </td>
          <td>(</td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>stream_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>block</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>copy_result</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Synchronize/query the execution on the stream. This function can be used to check whether the current execution on the stream is finished or also be used to wait until the execution to be finished.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stream_id</td><td>Stream index. </td></tr>
    <tr><td class="paramname">block</td><td>Wait for the execution to finish or not. true by default. </td></tr>
    <tr><td class="paramname">copy_result</td><td>If false, it will not copy result back to CPU.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the current operation on the stream is finished otherwise false. </dd></dl>
<div class="fragment"><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">if</span> (block) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">sync</a>(stream_id, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keywordflow">if</span> (copy_result &amp;&amp; dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == WAIT_KERNEL) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        checkCudaErrors(cudaMemcpyAsync(streams[stream_id].out,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                                      streams[stream_id].out_d,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                                      streams[stream_id].out_len,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                                                      cudaMemcpyDeviceToHost,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                                                      dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id)));</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_COPY);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">sync</a>(stream_id, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, READY);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == WAIT_COPY) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, READY);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <span class="keywordflow">if</span> (!dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">sync</a>(stream_id, <span class="keyword">false</span>))</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == WAIT_KERNEL) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        <span class="comment">//if no need for data copy</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                        <span class="keywordflow">if</span> (!copy_result) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, READY);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                        checkCudaErrors(cudaMemcpyAsync(streams[stream_id].out,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                                      streams[stream_id].out_d,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                                      streams[stream_id].out_len,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                                                      cudaMemcpyDeviceToHost,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                                                      dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id)));</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_COPY);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == WAIT_COPY) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, READY);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == READY) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        assert(0);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d01/classaes__context_a3638659adca332c65dccb8291a056dd3_cgraph.png" border="0" usemap="#d7/d01/classaes__context_a3638659adca332c65dccb8291a056dd3_cgraph" alt=""/></div>
<map name="d7/d01/classaes__context_a3638659adca332c65dccb8291a056dd3_cgraph" id="d7/d01/classaes__context_a3638659adca332c65dccb8291a056dd3_cgraph">
<area shape="rect" title=" " alt="" coords="5,111,131,138"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100" title=" " alt="" coords="183,5,317,47"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362" title=" " alt="" coords="183,71,317,112"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b" title=" " alt="" coords="183,136,317,177"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0" title=" " alt="" coords="179,202,321,229"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d01/classaes__context_a3638659adca332c65dccb8291a056dd3_icgraph.png" border="0" usemap="#d7/d01/classaes__context_a3638659adca332c65dccb8291a056dd3_icgraph" alt=""/></div>
<map name="d7/d01/classaes__context_a3638659adca332c65dccb8291a056dd3_icgraph" id="d7/d01/classaes__context_a3638659adca332c65dccb8291a056dd3_icgraph">
<area shape="rect" title=" " alt="" coords="221,85,347,112"/>
<area shape="rect" href="../../d7/d01/classaes__context.html#a32e08d6083d19476f285b6317da8771b" title=" " alt="" coords="5,5,173,32"/>
<area shape="rect" href="../../d7/d01/classaes__context.html#a350c3c86ba1d0769b6b7e4a5e6983afc" title=" " alt="" coords="5,56,173,83"/>
<area shape="rect" href="../../d7/d01/classaes__context.html#a9c4b9ec90489cb61505c0d0fc2c71141" title=" " alt="" coords="16,107,163,149"/>
<area shape="rect" href="../../d7/d01/classaes__context.html#a4e565046430a3bc259b301ab9f0d3124" title=" " alt="" coords="16,173,163,214"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="aclassdevice__context_html_ad476e92913643562d591a05976a94aa3"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3">device_context::get_cuda_mem_pool</a></div><div class="ttdeci">class cuda_mem_pool * get_cuda_mem_pool(const unsigned stream_id)</div><div class="ttdef"><b>Definition:</b> device_context.cc:153</div></div>
<div class="ttc" id="aclassdevice__context_html_a8771ee68f705bf0a639dec3f7cafff09"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">device_context::use_stream</a></div><div class="ttdeci">bool use_stream()</div><div class="ttdef"><b>Definition:</b> device_context.hh:126</div></div>
<div class="ttc" id="aclassdevice__context_html_a02a5dfdebfb49aca26810f7696abf100"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">device_context::get_state</a></div><div class="ttdeci">STATE get_state(const unsigned stream_id)</div><div class="ttdef"><b>Definition:</b> device_context.cc:116</div></div>
<div class="ttc" id="aclassaes__context_html_a3638659adca332c65dccb8291a056dd3"><div class="ttname"><a href="../../d7/d01/classaes__context.html#a3638659adca332c65dccb8291a056dd3">aes_context::sync</a></div><div class="ttdeci">bool sync(const unsigned int stream_id, const bool block=true, const bool copy_result=true)</div><div class="ttdef"><b>Definition:</b> aes_context.cc:98</div></div>
<div class="ttc" id="aclassdevice__context_html_a587948f6d4120575e20805d46e98a9e0"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">device_context::sync</a></div><div class="ttdeci">bool sync(const unsigned stream_id, const bool block=true)</div><div class="ttdef"><b>Definition:</b> device_context.cc:70</div></div>
<div class="ttc" id="aclassdevice__context_html_a82b0694aec84547210e4c030d3b8de6b"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">device_context::set_state</a></div><div class="ttdeci">void set_state(const unsigned stream_id, const STATE state)</div><div class="ttdef"><b>Definition:</b> device_context.cc:98</div></div>
<div class="ttc" id="aclassdevice__context_html_ac47740180604321ca3c97e7f34d8f362"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">device_context::get_stream</a></div><div class="ttdeci">cudaStream_t get_stream(const unsigned stream_id)</div><div class="ttdef"><b>Definition:</b> device_context.cc:124</div></div>
<div class="ttc" id="aclasscuda__mem__pool_html"><div class="ttname"><a href="../../d4/d45/classcuda__mem__pool.html">cuda_mem_pool</a></div><div class="ttdef"><b>Definition:</b> cuda_mem_pool.hh:10</div></div>
<div class="ttc" id="aclassdevice__context_html_af66b74eb3019d5936c9759463c55e7f8"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#af66b74eb3019d5936c9759463c55e7f8">device_context::clear_checkbits</a></div><div class="ttdeci">void clear_checkbits(const unsigned stream_id, const unsigned num_blks)</div><div class="ttdef"><b>Definition:</b> device_context.cc:139</div></div>
<div class="ttc" id="aclassdevice__context_html_a8e7de8d3adb516d1397a07fe807821aa"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa">device_context::get_dev_checkbits</a></div><div class="ttdeci">uint8_t * get_dev_checkbits(const unsigned stream_id)</div><div class="ttdef"><b>Definition:</b> device_context.cc:132</div></div>
<div class="ttc" id="aclassmem__pool_html_ac4b33e484cc88248bf0f305869df465b"><div class="ttname"><a href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">mem_pool::alloc</a></div><div class="ttdeci">void * alloc(unsigned long size)</div><div class="ttdef"><b>Definition:</b> memory_pool.hh:34</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 10 2021 22:17:29 for libgpucrypto by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
