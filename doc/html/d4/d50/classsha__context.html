<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libgpucrypto: sha_context Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libgpucrypto
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">sha_context Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../df/d88/sha__context_8hh_source.html">sha_context.hh</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a31042fe5146373f51cd706c81141c15e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d50/classsha__context.html#a31042fe5146373f51cd706c81141c15e">sha_context</a> (<a class="el" href="../../de/d3e/classdevice__context.html">device_context</a> *dev_ctx)</td></tr>
<tr class="separator:a31042fe5146373f51cd706c81141c15e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71f6f8b24db1f1f10a7e89c203bb7971"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d50/classsha__context.html#a71f6f8b24db1f1f10a7e89c203bb7971">hmac_sha1</a> (const void *memory_start, const unsigned long in_pos, const unsigned long keys_pos, const unsigned long pkt_offset_pos, const unsigned long lengths_pos, const unsigned long data_size, unsigned char *out, const unsigned long num_flows, unsigned int stream_id)</td></tr>
<tr class="separator:a71f6f8b24db1f1f10a7e89c203bb7971"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad25c770cf9dac126590d85c776a93d3f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d50/classsha__context.html#ad25c770cf9dac126590d85c776a93d3f">sync</a> (const unsigned int stream_id, const bool block=true, const bool copy_result=true)</td></tr>
<tr class="separator:ad25c770cf9dac126590d85c776a93d3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>class <a class="el" href="../../d4/d50/classsha__context.html">sha_context</a></p>
<p>Interface for HMAC-SHA1 in GPU. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a31042fe5146373f51cd706c81141c15e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31042fe5146373f51cd706c81141c15e">&#9670;&nbsp;</a></span>sha_context()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sha_context::sha_context </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d3e/classdevice__context.html">device_context</a> *&#160;</td>
          <td class="paramname"><em>dev_ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructior.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dev_ctx</td><td>Device context pointer. Device context must be initialized before calling this function. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt;MAX_STREAM; i++) {</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                streams[i].out = 0;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                streams[i].out_d = 0;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                streams[i].out_len = 0;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        }</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        dev_ctx_ = dev_ctx;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a71f6f8b24db1f1f10a7e89c203bb7971"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71f6f8b24db1f1f10a7e89c203bb7971">&#9670;&nbsp;</a></span>hmac_sha1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sha_context::hmac_sha1 </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>memory_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>in_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>keys_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>pkt_offset_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>lengths_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>data_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned long&#160;</td>
          <td class="paramname"><em>num_flows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>stream_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>It executes hmac_sha1 in GPU. If stream is enabled it will run in non-blocking mode, if not, it will run in blocking mode and the result will be written back to out at the end of function call. This function takes one or more data and returns HMAC-SHA1 value for all of them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">memory_start</td><td>Starting point of input data. All input data should be be packed in to single continous region before making call to this function. </td></tr>
    <tr><td class="paramname">in_pos</td><td>Offset of plain texts. </td></tr>
    <tr><td class="paramname">keys_pos</td><td>Offset of region that stores HHAC keys. </td></tr>
    <tr><td class="paramname">pkt_offset_pos</td><td>Offset of region that stores position of each plain text. </td></tr>
    <tr><td class="paramname">lengths_pos</td><td>Offset of region that stores length of each plain text. </td></tr>
    <tr><td class="paramname">data_size</td><td>Total amount of input data. </td></tr>
    <tr><td class="paramname">out</td><td>Buffer to store output. </td></tr>
    <tr><td class="paramname">num_flows</td><td>Number of plain texts to be hashed. </td></tr>
    <tr><td class="paramname">stream_id</td><td>Stream index. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        assert(dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == READY);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_KERNEL);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <a class="code" href="../../d4/d45/classcuda__mem__pool.html">cuda_mem_pool</a> *pool = dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3">get_cuda_mem_pool</a>(stream_id);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keywordtype">void</span> *memory_d = pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(data_size);;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="comment">//copy input data</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        cudaMemcpyAsync(memory_d,</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                        memory_start,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                        data_size,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                        cudaMemcpyHostToDevice,</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="comment">//variables need for kernel launch</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordtype">int</span> threads_per_blk = SHA1_THREADS_PER_BLK;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keywordtype">int</span> num_blks = (num_flows+threads_per_blk-1)/threads_per_blk;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="comment">//allocate buffer for output</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        uint32_t *out_d = (uint32_t *)pool-&gt;<a class="code" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">alloc</a>(20 * num_flows);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="comment">//initialize input memory offset in device memory</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordtype">char</span>     *in_d         = (<span class="keywordtype">char</span> *)memory_d + in_pos;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordtype">char</span>     *keys_d       = (<span class="keywordtype">char</span> *)memory_d + keys_pos;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        uint32_t *pkt_offset_d = (uint32_t *)((uint8_t *)memory_d + offsets_pos);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        uint16_t *lengths_d    = (uint16_t *)((uint8_t *)memory_d + lengths_pos);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="comment">//clear checkbits before kernel execution</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#af66b74eb3019d5936c9759463c55e7f8">clear_checkbits</a>(stream_id, num_blks);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>() &amp;&amp; stream_id &gt; 0) {  <span class="comment">//with stream</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                hmac_sha1_gpu(in_d,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                              keys_d,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                              pkt_offset_d,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                              lengths_d,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                              out_d,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                              num_flows,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                              dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa">get_dev_checkbits</a>(stream_id),</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                              threads_per_blk,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                              dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id));</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>() &amp;&amp; stream_id == 0) {<span class="comment">//w/o stream</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                hmac_sha1_gpu(in_d,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                              keys_d,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                              pkt_offset_d,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                              lengths_d,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                              out_d,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                              num_flows,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                              dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa">get_dev_checkbits</a>(stream_id),</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                              SHA1_THREADS_PER_BLK);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                assert(0);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        assert(cudaGetLastError() == cudaSuccess);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        streams[stream_id].out_d   = (uint8_t*)out_d;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        streams[stream_id].out     = out;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        streams[stream_id].out_len = 20 * num_flows;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="comment">//if stream is not used then sync (assuming blocking mode)</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">use_stream</a>() &amp;&amp; stream_id == 0) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <a class="code" href="../../d4/d50/classsha__context.html#ad25c770cf9dac126590d85c776a93d3f">sync</a>(stream_id);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d50/classsha__context_a71f6f8b24db1f1f10a7e89c203bb7971_cgraph.png" border="0" usemap="#d4/d50/classsha__context_a71f6f8b24db1f1f10a7e89c203bb7971_cgraph" alt=""/></div>
<map name="d4/d50/classsha__context_a71f6f8b24db1f1f10a7e89c203bb7971_cgraph" id="d4/d50/classsha__context_a71f6f8b24db1f1f10a7e89c203bb7971_cgraph">
<area shape="rect" title=" " alt="" coords="5,253,171,280"/>
<area shape="rect" href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b" title=" " alt="" coords="233,5,347,32"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#af66b74eb3019d5936c9759463c55e7f8" title=" " alt="" coords="219,57,361,98"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3" title=" " alt="" coords="223,122,357,163"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa" title=" " alt="" coords="223,187,357,229"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100" title=" " alt="" coords="414,231,547,273"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362" title=" " alt="" coords="414,297,547,338"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b" title=" " alt="" coords="414,414,547,455"/>
<area shape="rect" href="../../d4/d50/classsha__context.html#ad25c770cf9dac126590d85c776a93d3f" title=" " alt="" coords="227,355,353,381"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09" title=" " alt="" coords="222,457,358,498"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0" title=" " alt="" coords="409,363,552,389"/>
</map>
</div>

</div>
</div>
<a id="ad25c770cf9dac126590d85c776a93d3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad25c770cf9dac126590d85c776a93d3f">&#9670;&nbsp;</a></span>sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sha_context::sync </td>
          <td>(</td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>stream_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>block</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>copy_result</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Synchronize/query the execution on the stream. This function can be used to check whether the current execution on the stream is finished or also be used to wait until the execution to be finished.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stream_id</td><td>Stream index. </td></tr>
    <tr><td class="paramname">block</td><td>Wait for the execution to finish or not. true by default. </td></tr>
    <tr><td class="paramname">copy_result</td><td>If false, it will not copy result back to CPU.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the current operation on the stream is finished otherwise false. </dd></dl>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;{</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordflow">if</span> (block) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">sync</a>(stream_id, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="keywordflow">if</span> (copy_result &amp;&amp; dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == WAIT_KERNEL) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                        checkCudaErrors(cudaMemcpyAsync(streams[stream_id].out,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                                                      streams[stream_id].out_d,</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                                                      streams[stream_id].out_len,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                                      cudaMemcpyDeviceToHost,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                                      dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id)));</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_COPY);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">sync</a>(stream_id, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == WAIT_COPY) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">sync</a>(stream_id, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, READY);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                <span class="keywordflow">if</span> (!dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">sync</a>(stream_id, <span class="keyword">false</span>))</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == WAIT_KERNEL) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                        <span class="comment">//if no need for data copy</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        <span class="keywordflow">if</span> (!copy_result) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, READY);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        checkCudaErrors(cudaMemcpyAsync(streams[stream_id].out,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                                      streams[stream_id].out_d,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                                      streams[stream_id].out_len,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                                      cudaMemcpyDeviceToHost,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                                      dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">get_stream</a>(stream_id)));</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, WAIT_COPY);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == WAIT_COPY) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                        dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">set_state</a>(stream_id, READY);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev_ctx_-&gt;<a class="code" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">get_state</a>(stream_id) == READY) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        assert(0);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d50/classsha__context_ad25c770cf9dac126590d85c776a93d3f_cgraph.png" border="0" usemap="#d4/d50/classsha__context_ad25c770cf9dac126590d85c776a93d3f_cgraph" alt=""/></div>
<map name="d4/d50/classsha__context_ad25c770cf9dac126590d85c776a93d3f_cgraph" id="d4/d50/classsha__context_ad25c770cf9dac126590d85c776a93d3f_cgraph">
<area shape="rect" title=" " alt="" coords="5,111,131,138"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100" title=" " alt="" coords="183,5,317,47"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362" title=" " alt="" coords="183,71,317,112"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b" title=" " alt="" coords="183,136,317,177"/>
<area shape="rect" href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0" title=" " alt="" coords="179,202,321,229"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d50/classsha__context_ad25c770cf9dac126590d85c776a93d3f_icgraph.png" border="0" usemap="#d4/d50/classsha__context_ad25c770cf9dac126590d85c776a93d3f_icgraph" alt=""/></div>
<map name="d4/d50/classsha__context_ad25c770cf9dac126590d85c776a93d3f_icgraph" id="d4/d50/classsha__context_ad25c770cf9dac126590d85c776a93d3f_icgraph">
<area shape="rect" title=" " alt="" coords="219,5,344,32"/>
<area shape="rect" href="../../d4/d50/classsha__context.html#a71f6f8b24db1f1f10a7e89c203bb7971" title=" " alt="" coords="5,5,171,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="aclassdevice__context_html_ad476e92913643562d591a05976a94aa3"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#ad476e92913643562d591a05976a94aa3">device_context::get_cuda_mem_pool</a></div><div class="ttdeci">class cuda_mem_pool * get_cuda_mem_pool(const unsigned stream_id)</div><div class="ttdef"><b>Definition:</b> device_context.cc:153</div></div>
<div class="ttc" id="aclassdevice__context_html_a8771ee68f705bf0a639dec3f7cafff09"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a8771ee68f705bf0a639dec3f7cafff09">device_context::use_stream</a></div><div class="ttdeci">bool use_stream()</div><div class="ttdef"><b>Definition:</b> device_context.hh:126</div></div>
<div class="ttc" id="aclassdevice__context_html_a02a5dfdebfb49aca26810f7696abf100"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a02a5dfdebfb49aca26810f7696abf100">device_context::get_state</a></div><div class="ttdeci">STATE get_state(const unsigned stream_id)</div><div class="ttdef"><b>Definition:</b> device_context.cc:116</div></div>
<div class="ttc" id="aclassdevice__context_html_a587948f6d4120575e20805d46e98a9e0"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a587948f6d4120575e20805d46e98a9e0">device_context::sync</a></div><div class="ttdeci">bool sync(const unsigned stream_id, const bool block=true)</div><div class="ttdef"><b>Definition:</b> device_context.cc:70</div></div>
<div class="ttc" id="aclassdevice__context_html_a82b0694aec84547210e4c030d3b8de6b"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a82b0694aec84547210e4c030d3b8de6b">device_context::set_state</a></div><div class="ttdeci">void set_state(const unsigned stream_id, const STATE state)</div><div class="ttdef"><b>Definition:</b> device_context.cc:98</div></div>
<div class="ttc" id="aclassdevice__context_html_ac47740180604321ca3c97e7f34d8f362"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#ac47740180604321ca3c97e7f34d8f362">device_context::get_stream</a></div><div class="ttdeci">cudaStream_t get_stream(const unsigned stream_id)</div><div class="ttdef"><b>Definition:</b> device_context.cc:124</div></div>
<div class="ttc" id="aclasscuda__mem__pool_html"><div class="ttname"><a href="../../d4/d45/classcuda__mem__pool.html">cuda_mem_pool</a></div><div class="ttdef"><b>Definition:</b> cuda_mem_pool.hh:10</div></div>
<div class="ttc" id="aclassdevice__context_html_af66b74eb3019d5936c9759463c55e7f8"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#af66b74eb3019d5936c9759463c55e7f8">device_context::clear_checkbits</a></div><div class="ttdeci">void clear_checkbits(const unsigned stream_id, const unsigned num_blks)</div><div class="ttdef"><b>Definition:</b> device_context.cc:139</div></div>
<div class="ttc" id="aclassdevice__context_html_a8e7de8d3adb516d1397a07fe807821aa"><div class="ttname"><a href="../../de/d3e/classdevice__context.html#a8e7de8d3adb516d1397a07fe807821aa">device_context::get_dev_checkbits</a></div><div class="ttdeci">uint8_t * get_dev_checkbits(const unsigned stream_id)</div><div class="ttdef"><b>Definition:</b> device_context.cc:132</div></div>
<div class="ttc" id="aclasssha__context_html_ad25c770cf9dac126590d85c776a93d3f"><div class="ttname"><a href="../../d4/d50/classsha__context.html#ad25c770cf9dac126590d85c776a93d3f">sha_context::sync</a></div><div class="ttdeci">bool sync(const unsigned int stream_id, const bool block=true, const bool copy_result=true)</div><div class="ttdef"><b>Definition:</b> sha_context.cc:95</div></div>
<div class="ttc" id="aclassmem__pool_html_ac4b33e484cc88248bf0f305869df465b"><div class="ttname"><a href="../../d9/d5f/classmem__pool.html#ac4b33e484cc88248bf0f305869df465b">mem_pool::alloc</a></div><div class="ttdeci">void * alloc(unsigned long size)</div><div class="ttdef"><b>Definition:</b> memory_pool.hh:34</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 10 2021 22:17:29 for libgpucrypto by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
